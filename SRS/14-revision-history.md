# Revision History

This file preserves the Revision History section from the monolithic SRS: `1. Research/VNlaw_WebApps_SRS_v1.5.2.md` (content v1.6.1).

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-12-20 | Initial draft |
| 1.1.0 | 2025-12-21 | Added implementation phases |
| 1.2.0 | 2025-12-22 | Added TypeScript interfaces, environment config |
| 1.3.0 | 2025-12-22 | AI-Agent ready optimizations |
| 1.4.0 | 2025-12-23 | Contract governance, Demo Mode, non-streaming MVP, security clarifications |
| 1.5.0 | 2025-12-24 | Critical contract fixes: added `messageId` to chat response, fixed `retryAfterSeconds` type, completed ErrorCode union, removed SEARCH_PARTIAL_FAILURE from error codes (partial is success), clarified `/v1/health` auth exception, corrected feature flag defaults, unified URL routing to `/`, defined `requestId` as UUID v4, documented `_meta` field policy, standardized scope format, added security requirements (XSS, external links, Demo Mode guard), added toolchain specification, clarified auth/connect pattern, added CORS requirements |
| 1.5.1 | 2025-12-24 | Consistency fixes: fixed section numbering (6.4/6.5), fixed Phase 3 URL pattern, made `/settings` consistently Required, clarified Netlify publish dir for monorepo, removed invalid JSON comments, added `INFOBANK_SEARCH_ENABLED` to FeatureFlags type, completed retry matrix with 502, expanded canonical result model, added CSP/HSTS to netlify.toml, aligned recent searches with privacy guidance, clarified requestId vs X-Request-Id, picked pnpm + Vitest, marked Section 19 types as stub |
| 1.5.2 | 2025-12-24 | Design decisions implemented: (1) Generated `openapi.yaml` from Section 6.2 — now ✅ Ready; (2) Multi-turn chat uses stateless `messages[]` array with `contextLimitWarning` field; (3) SSE streaming marked as POST-MVP deferred with hook for future; (4) Added dynamic CORS origin validation pattern for `*.netlify.app` previews; (5) Preview auth strategy: PR previews use Demo Mode, `staging.vnlaw.app` uses real Kinde auth; (6) Referenced authoritative sample JSON files by path; (7) Corrected OpenAPI/tooling notes for the now-present spec |
| **1.6.0** | **2025-12-25** | **Major security & contract update based on consolidated technical review (23 issues addressed):** <br/>• **Section 0.2:** Added Critical Security Requirements highlighting 3 blockers <br/>• **Section 3.3.1:** Added comprehensive CORS Security Policy (production/preview origins, preflight handling) - Issues #6, #7 <br/>• **Section 3.4.1:** Added UserTokens Collection Security requirements (KMS encryption, Firestore rules, audit logging) - Issue #5 <br/>• **Section 5.1 FR-AUTH-05:** Expanded OAuth security (PKCE, state validation, identity verification, redirect allowlist, callback sequence) - Issues #2, #3, #4 <br/>• **Section 6.0.3:** Clarified HTTP 200 vs 207 deterministic rule for partial success - Issue #13 <br/>• **Section 6.2.0:** Added CORS Preflight Handling requirements - Issue #6 <br/>• **Section 6.2.1.1:** Strengthened requestId as MANDATORY in all responses - Issue #10 <br/>• **Section 6.2.2 & 6.2.3:** Added input validation constraints (query/message maxLength, DoS prevention) - Issue #19 <br/>• **Section 6.3.1:** Added Error Response Polymorphism for typed error details (AUTH_GOOGLE_DISCONNECTED) - Issue #8 <br/>• **Section 6.4:** Added REQUEST_TIMEOUT error code - Issue #22 <br/>• **Section 6.5:** Added concrete rate limit values (60 req/min per user, 10 req/min for health, 5 req/min for OAuth) - Issue #14 <br/>• **Section 7.3.8:** Added OAuth Token Storage Security summary (references Section 3.4.1) - Issue #5 <br/>• **Section 16.1.1:** Added OpenAPI OAuth Endpoints Specification as CRITICAL BLOCKER (GET /connect, GET /callback, DELETE /me/workspace) - Issue #1 <br/>• **Section 16.1.2:** Added Token Storage Security Implementation as CRITICAL BLOCKER (KMS setup, Firestore rules, audit logging checklists) - Issue #5 <br/>• **Updated Section 0.1:** Marked OAuth flow and token security as resolved, added new open questions for rate limits and 200 vs 207 confirmation <br/>• **Updated blocking artifacts table:** Marked openapi.yaml as incomplete pending OAuth endpoints |
| **1.6.1** | **2025-12-25** | **Internal consistency fixes & missing items completion (10 fixes based on verification review):** <br/>• **Fixed OpenAPI status:** Changed from "✅ Ready" to "⚠️ Incomplete" with status note explaining OAuth endpoints pending (Section 0 contracts table) - Verification contradiction #1 <br/>• **Added requestId to examples:** Updated `/v1/me`, `/v1/flags`, `/v1/health` response examples to include mandatory `requestId` field (Sections 6.2.6, 6.2.7, 6.2.8) - Contradiction #2 <br/>• **Standardized feature flags casing:** Changed all code examples and TypeScript types to use `SCREAMING_SNAKE_CASE` matching API contract; added optional camelCase transform helper (Sections 12.1, 19.1.3) - Contradiction #3 <br/>• **Fixed URL param drift:** Standardized to singular `scope` param (not plural `scopes`) matching MVP spec; updated code examples in Section 12.1 - Contradiction #4 <br/>• **Aligned OAuth return URL:** Changed from `/settings?workspace_connected=1` to `/workspace?status=connected` consistently (Section 5.4) - Contradiction #5 <br/>• **Clarified citation deduplication:** Updated Section 5.3.1 to specify backend-only dedup (frontend displays as-provided), referencing Section 6.2.9 - Contradiction #6 <br/>• **Removed CORS wildcard snippet:** Replaced old permissive code allowing `*.netlify.app` with strict environment-based validation (Section 3.3) - Contradiction #7 <br/>• **Standardized conversationId format:** Changed from `conv_<random>` prefix to plain UUID v4 in common fields table (Section 6.2.1.1) - Contradiction #8 <br/>• **Added Phase 1 Kinde prerequisites:** Comprehensive external setup requirements including tenant config, application setup, callback URLs, environment variables, and acceptance criteria (Section 17.1) - Issue #21 <br/>• **Added Section 7.3.9 Token Persistence Edge Cases:** Documented 8 edge case scenarios (Kinde token expiry, browser tab close/reopen, crash/restore, Google OAuth token expiry/revocation, long idle period, network failure during OAuth, concurrent tab OAuth) with expected behaviors, acceptance criteria, implementation guidance, testing requirements, and monitoring recommendations - Issue #23 <br/>• **Renumbered Section 7.3.9 → 7.3.10:** Old "Recent Searches Privacy" section renumbered to make room for Token Persistence Edge Cases |
